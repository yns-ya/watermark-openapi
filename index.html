<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Watermark API – Minimal Integration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg{background:linear-gradient(-45deg,#667eea,#764ba2,#f093fb,#4facfe);background-size:400% 400%;animation:gradient 15s ease infinite}
    @keyframes gradient{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
    .glass{background:rgba(15,23,42,.7);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}
    .code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;white-space:pre;overflow:auto}
  </style>
</head>
<body class="min-h-screen gradient-bg text-white">
  <div class="container mx-auto px-4 py-10 max-w-5xl">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-2">Watermark API – Integration</h1>
      <p class="text-purple-100">Simple, copy‑paste examples with a live tester</p>
    </header>

    <!-- Config Panel -->
    <section class="glass rounded-xl p-6 mb-8">
      <h2 class="text-2xl font-semibold mb-4">Configuration</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <label class="block">
          <span class="text-sm text-purple-200">API Base URL</span>
          <input id="baseUrl" type="text" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3" placeholder="https://<site>.netlify.app/api/watermark" value="/api/watermark" />
        </label>
        <label class="block">
          <span class="text-sm text-purple-200">JWT Token</span>
          <input id="jwt" type="password" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3" placeholder="Paste your Bearer token" />
        </label>
      </div>
      <p class="text-xs text-purple-300 mt-3">Tip: On Netlify, the redirect in netlify.toml maps /api/* → /.netlify/functions/*.</p>
    </section>

    <!-- Live Tester -->
    <section class="glass rounded-xl p-6 mb-8">
      <h2 class="text-2xl font-semibold mb-4">Live Tester</h2>
      <form id="tester" class="space-y-4" onsubmit="return false;">
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="text-sm text-purple-200">Image (JPG/PNG/WebP, ≤ 6MB)</span>
            <input id="image" type="file" accept="image/*" class="mt-1 w-full text-sm" required />
          </label>
          <label class="block">
            <span class="text-sm text-purple-200">Watermark Type</span>
            <select id="wmType" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3">
              <option value="text">text</option>
              <option value="image">image</option>
            </select>
          </label>
        </div>
        <div id="textFields" class="grid md:grid-cols-2 gap-4">
          <label class="block">
            <span class="text-sm text-purple-200">Text</span>
            <input id="text" type="text" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3" placeholder="Watermark text" />
          </label>
          <label class="block">
            <span class="text-sm text-purple-200">Font</span>
            <select id="font" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3">
              <option>Roboto</option>
              <option>NotoSansThai</option>
              <option>Inter</option>
            </select>
          </label>
        </div>
        <div id="imageField" class="hidden">
          <label class="block">
            <span class="text-sm text-purple-200">Watermark Image</span>
            <input id="wmImage" type="file" accept="image/*" class="mt-1 w-full text-sm" />
          </label>
        </div>
        <div class="grid md:grid-cols-3 gap-4">
          <label class="block">
            <span class="text-sm text-purple-200">Opacity (0.0 - 1.0)</span>
            <input id="opacity" type="number" min="0" max="1" step="0.01" value="0.2" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3" />
          </label>
          <label class="block">
            <span class="text-sm text-purple-200">Mode</span>
            <select id="mode" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3">
              <option value="diagonal_tile">diagonal_tile</option>
              <option value="grid">grid</option>
              <option value="single">single</option>
            </select>
          </label>
          <label class="block">
            <span class="text-sm text-purple-200">Spacing (px)</span>
            <input id="spacing" type="number" min="20" max="2000" step="10" value="280" class="mt-1 w-full rounded-md bg-slate-800/60 border border-white/10 p-3" />
          </label>
        </div>
        <button id="runBtn" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg font-semibold disabled:opacity-60">Run</button>
      </form>

      <div id="resultWrap" class="mt-6 hidden">
        <h3 class="text-xl font-semibold mb-3">Result</h3>
        <img id="preview" alt="Result preview" class="rounded-lg border border-white/10 max-h-[480px]" />
        <div class="mt-3 space-x-3">
          <a id="download" class="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30" download="watermarked.png">Download</a>
          <button id="reset" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20">Reset</button>
        </div>
      </div>

      <p id="error" class="mt-4 text-red-300 hidden" role="alert"></p>
    </section>

    <!-- Vanilla JS Example -->
    <section class="glass rounded-xl p-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-2xl font-semibold">Vanilla JS (fetch)</h2>
        <button class="px-3 py-2 bg-white/20 rounded-lg hover:bg-white/30" onclick="copyCode('jsExample')">Copy</button>
      </div>
      <pre class="code text-sm bg-black/40 rounded-lg p-4" id="jsExample">const url = '/api/watermark'; // or 'https://<site>.netlify.app/api/watermark'
const jwt = '<JWT_TOKEN>';

const form = new FormData();
form.append('image', fileInput.files[0]);
form.append('type', 'text');
form.append('text', 'Sample');
form.append('font', 'Roboto');
form.append('frequency', JSON.stringify({ mode: 'diagonal_tile', spacing_px: 280 }));
form.append('opacity', '0.2');

const res = await fetch(url, {
  method: 'POST',
  headers: { Authorization: `Bearer ${jwt}` },
  body: form,
});
if (!res.ok) throw new Error(await res.text());
const blob = await res.blob();
// Use blob in an <img> or download
</pre>
    </section>

    <div class="text-center mt-10">
      <a href="/" class="inline-block px-8 py-3 bg-white/10 rounded-full hover:bg-white/20">← Back to Home</a>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const image = $('image');
    const wmType = $('wmType');
    const textFields = $('textFields');
    const imageField = $('imageField');

    wmType.addEventListener('change', () => {
      const isText = wmType.value === 'text';
      textFields.classList.toggle('hidden', !isText);
      imageField.classList.toggle('hidden', isText);
    });

    $('runBtn').addEventListener('click', run);
    $('reset').addEventListener('click', reset);

    async function run() {
      const err = $('error'); err.classList.add('hidden'); err.textContent = '';
      const btn = $('runBtn'); btn.disabled = true; btn.textContent = 'Running...';
      try {
        const file = image.files[0];
        if (!file) throw new Error('Please choose an image file');
        if (file.size > 6*1024*1024) throw new Error('File too large (max 6MB)');

        const url = $('baseUrl').value.trim() || '/api/watermark';
        const jwt = $('jwt').value.trim();
        const form = new FormData();
        form.append('image', file);
        form.append('type', wmType.value);

        if (wmType.value === 'text') {
          form.append('text', $('text').value || 'Sample');
          form.append('font', $('font').value || 'Roboto');
        } else {
          const wm = $('wmImage').files[0];
          if (!wm) throw new Error('Please choose a watermark image');
          form.append('wm_image', wm);
        }

        form.append('opacity', $('opacity').value || '0.2');
        form.append('frequency', JSON.stringify({
          mode: $('mode').value,
          spacing_px: parseInt($('spacing').value || '280', 10)
        }));

        const res = await fetch(url, {
          method: 'POST',
          headers: jwt ? { Authorization: `Bearer ${jwt}` } : {},
          body: form
        });

        if (!res.ok) {
          let msg = 'Request failed';
          try { const j = await res.json(); msg = j.message || JSON.stringify(j); } catch {}
          throw new Error(msg);
        }

        const blob = await res.blob();
        const objectUrl = URL.createObjectURL(blob);
        $('preview').src = objectUrl;
        $('download').href = objectUrl;
        $('resultWrap').classList.remove('hidden');
      } catch (e) {
        $('error').textContent = e?.message || 'Unknown error';
        $('error').classList.remove('hidden');
      } finally {
        btn.disabled = false; btn.textContent = 'Run';
      }
    }

    function reset() {
      $('tester').reset();
      $('resultWrap').classList.add('hidden');
      $('preview').src = '';
    }

    function copyCode(id) {
      const el = $(id);
      navigator.clipboard.writeText(el.textContent).then(()=>{
        alert('Copied');
      }).catch(()=>alert('Copy failed'))
    }
  </script>
</body>
</html>
