<!-- Refactored minimal integration page -->
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watermark API – Minimal Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    
    
    
    
    <style>
        .gradient-bg {
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .glass {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        pre[class*="language-"] {
            margin: 0 !important;
            border-radius: 0 0 0.75rem 0.75rem !important;
        }
        .code-block {
            position: relative;
        }
        .copy-button {
            transition: all 0.2s;
        }
        .copy-button:hover {
            transform: scale(1.1);
        }
        .copy-button.copied {
            background-color: rgb(34, 197, 94) !important;
        }
    </style>
</head>
<body class="min-h-screen gradient-bg text-white">
    <div class="container mx-auto px-4 py-12 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold mb-4">Integration Guide</h1>
            <p class="text-xl text-purple-200">Ready-to-use code snippets for your project</p>
        </header>

        <!-- Tab Navigation -->
        <div class="flex justify-center mb-8 space-x-4">
            <button onclick="showTab('ai')" id="tab-ai" class="tab-button px-6 py-3 rounded-full font-semibold transition-all bg-gradient-to-r from-purple-600 to-pink-600">
                <span class="flex items-center">
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                    </svg>
                    AI Prompt
                </span>
            </button>
            <button onclick="showTab('nodejs')" id="tab-nodejs" class="tab-button px-6 py-3 rounded-full font-semibold transition-all glass">
                <span class="flex items-center">
                    <svg class="w-5 h-5 mr-2 text-green-500" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M11.998,24c-0.321,0-0.641-0.084-0.922-0.247l-2.936-1.737c-0.438-0.245-0.224-0.332-0.08-0.383 c0.585-0.203,0.703-0.25,1.328-0.604c0.065-0.037,0.151-0.023,0.218,0.017l2.256,1.339c0.082,0.045,0.197,0.045,0.272,0l8.795-5.076 c0.082-0.047,0.134-0.141,0.134-0.238V6.921c0-0.099-0.053-0.192-0.137-0.242l-8.791-5.072c-0.081-0.047-0.189-0.047-0.271,0 L3.075,6.68C2.99,6.729,2.936,6.825,2.936,6.921v10.15c0,0.097,0.054,0.189,0.139,0.235l2.409,1.392 c1.307,0.654,2.108-0.116,2.108-0.89V7.787c0-0.142,0.114-0.253,0.256-0.253h1.115c0.139,0,0.255,0.112,0.255,0.253v10.021 c0,1.745-0.95,2.745-2.604,2.745c-0.508,0-0.909,0-2.026-0.551L2.28,18.675c-0.57-0.329-0.922-0.945-0.922-1.604V6.921 c0-0.659,0.353-1.275,0.922-1.603l8.795-5.082c0.557-0.315,1.296-0.315,1.848,0l8.794,5.082c0.57,0.329,0.924,0.944,0.924,1.603 v10.15c0,0.659-0.354,1.273-0.924,1.604l-8.794,5.078C12.643,23.916,12.324,24,11.998,24z M19.099,13.993 c0-1.9-1.284-2.406-3.987-2.763c-2.731-0.361-3.009-0.548-3.009-1.187c0-0.528,0.235-1.233,2.258-1.233 c1.807,0,2.473,0.389,2.747,1.607c0.024,0.115,0.129,0.199,0.247,0.199h1.141c0.071,0,0.138-0.031,0.186-0.081 c0.048-0.054,0.074-0.123,0.067-0.196c-0.177-2.098-1.571-3.076-4.388-3.076c-2.508,0-4.004,1.058-4.004,2.833 c0,1.925,1.488,2.457,3.895,2.695c2.88,0.282,3.103,0.703,3.103,1.269c0,0.983-0.789,1.402-2.642,1.402 c-2.327,0-2.839-0.584-3.011-1.742c-0.02-0.124-0.126-0.215-0.253-0.215h-1.137c-0.141,0-0.254,0.112-0.254,0.253 c0,1.482,0.806,3.248,4.655,3.248C17.501,17.007,19.099,15.91,19.099,13.993z"/>
                    </svg>
                    Node.js
                </span>
            </button>
            <button onclick="showTab('curl')" id="tab-curl" class="tab-button px-6 py-3 rounded-full font-semibold transition-all glass">
                <span class="flex items-center">
                    <svg class="w-5 h-5 mr-2 text-cyan-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    cURL
                </span>
            </button>
        </div>

        <!-- AI Prompt Section (simplified) -->
        <div id="content-ai" class="tab-content">
            <div class="glass rounded-xl overflow-hidden mb-8">
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                        </svg>
                        <h2 class="text-2xl font-bold">AI Assistant Prompt</h2>
                    </div>
                    <button onclick="copyCode('ai-prompt', event)" class="copy-button px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30">
                        <span class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy Prompt
                        </span>
                    </button>
                </div>
                <pre class="p-6 overflow-x-auto text-sm"><code id="ai-prompt" class="language-markdown">Copy this text and use it as an AI prompt to instruct an AI to integrate a frontend application with the Watermark API.</code></pre>
            </div>
        </div>

        <!-- Node.js Section -->
        <div id="content-nodejs" class="tab-content hidden">
            <div class="glass rounded-xl overflow-hidden mb-8">
                <div class="bg-gradient-to-r from-green-600 to-emerald-600 p-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-3" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.998,24c-0.321,0-0.641-0.084-0.922-0.247l-2.936-1.737c-0.438-0.245-0.224-0.332-0.08-0.383 c0.585-0.203,0.703-0.25,1.328-0.604c0.065-0.037,0.151-0.023,0.218,0.017l2.256,1.339c0.082,0.045,0.197,0.045,0.272,0l8.795-5.076 c0.082-0.047,0.134-0.141,0.134-0.238V6.921c0-0.099-0.053-0.192-0.137-0.242l-8.791-5.072c-0.081-0.047-0.189-0.047-0.271,0 L3.075,6.68C2.99,6.729,2.936,6.825,2.936,6.921v10.15c0,0.097,0.054,0.189,0.139,0.235l2.409,1.392 c1.307,0.654,2.108-0.116,2.108-0.89V7.787c0-0.142,0.114-0.253,0.256-0.253h1.115c0.139,0,0.255,0.112,0.255,0.253v10.021 c0,1.745-0.95,2.745-2.604,2.745c-0.508,0-0.909,0-2.026-0.551L2.28,18.675c-0.57-0.329-0.922-0.945-0.922-1.604V6.921 c0-0.659,0.353-1.275,0.922-1.603l8.795-5.082c0.557-0.315,1.296-0.315,1.848,0l8.794,5.082c0.57,0.329,0.924,0.944,0.924,1.603 v10.15c0,0.659-0.354,1.273-0.924,1.604l-8.794,5.078C12.643,23.916,12.324,24,11.998,24z"/>
                        </svg>
                        <h2 class="text-2xl font-bold">Node.js / TypeScript Example</h2>
                    </div>
                    <button onclick="copyCode('nodejs-code', event)" class="copy-button px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30">
                        <span class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy Code
                        </span>
                    </button>
                </div>
                <pre class="p-6 overflow-x-auto text-sm"><code id="nodejs-code" class="language-typescript">import { useState } from 'react';

interface WatermarkOptions {
  type: 'text' | 'image';
  text?: string;
  font?: 'NotoSansThai' | 'Roboto' | 'Inter';
  wm_image?: File;
  opacity?: number;
  frequency?: {
    mode: 'single' | 'grid' | 'diagonal_tile';
    position?: string;
    spacing_px?: number;
  };
  output_format?: 'png' | 'jpeg' | 'webp';
}

function useWatermark() {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const addWatermark = async (
    imageFile: File,
    options: WatermarkOptions
  ): Promise<Blob> => {
    setLoading(true);
    setError(null);

    // Validate file size
    if (imageFile.size > 6 * 1024 * 1024) {
      throw new Error('File too large (max 6MB)');
    }

    const formData = new FormData();
    formData.append('image', imageFile);
    formData.append('type', options.type);
    formData.append('frequency', JSON.stringify(
      options.frequency || { mode: 'diagonal_tile', spacing_px: 280 }
    ));

    if (options.type === 'text' && options.text && options.font) {
      formData.append('text', options.text);
      formData.append('font', options.font);
    } else if (options.type === 'image' && options.wm_image) {
      formData.append('wm_image', options.wm_image);
    }

    if (options.opacity) {
      formData.append('opacity', options.opacity.toString());
    }

    if (options.output_format) {
      formData.append('output_format', options.output_format);
    }

    try {
      const response = await fetch(
        'https://silly-seahorse-49d00d.netlify.app/.netlify/functions/watermark',
        {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${process.env.REACT_APP_JWT_TOKEN}`
          },
          body: formData
        }
      );

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.message);
      }

      return await response.blob();
    } catch (err) {
      const message = err instanceof Error ? err.message : 'Unknown error';
      setError(message);
      throw err;
    } finally {
      setLoading(false);
    }
  };

  return { addWatermark, loading, error };
}

// Usage Example
function WatermarkComponent() {
  const { addWatermark, loading, error } = useWatermark();
  const [result, setResult] = useState<string | null>(null);

  const handleSubmit = async (file: File) => {
    const blob = await addWatermark(file, {
      type: 'text',
      text: '© Copyright 2025',
      font: 'Roboto',
      opacity: 0.2,
      frequency: { mode: 'diagonal_tile', spacing_px: 280 }
    });

    const url = URL.createObjectURL(blob);
    setResult(url);

    // Cleanup
    return () => URL.revokeObjectURL(url);
  };

  return (
    <div>
      {loading && <p>Processing...</p>}
      {error && <p style={{ color: 'red' }}>{error}</p>}
      {result && <img src={result} alt="Watermarked" />}
    </div>
  );
}</code></pre>
            </div>
        </div>

        <!-- cURL Section -->
        <div id="content-curl" class="tab-content hidden">
            <div class="glass rounded-xl overflow-hidden mb-8">
                <div class="bg-gradient-to-r from-cyan-600 to-blue-600 p-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <h2 class="text-2xl font-bold">cURL Examples</h2>
                    </div>
                    <button onclick="copyCode('curl-code', event)" class="copy-button px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30">
                        <span class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy cURL
                        </span>
                    </button>
                </div>
                <pre class="p-6 overflow-x-auto text-sm"><code id="curl-code" class="language-bash"># Text Watermark Example
curl -X POST http://localhost:3000/api/watermark \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "image=@photo.jpg" \
  -F "type=text" \
  -F "text=© Copyright 2025" \
  -F "font=Roboto" \
  -F 'frequency={"mode":"diagonal_tile","spacing_px":280}' \
  -F "opacity=0.2" \
  -F "output_format=png" \
  --output watermarked.png

# Image Watermark Example
curl -X POST http://localhost:3000/api/watermark \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "image=@photo.jpg" \
  -F "type=image" \
  -F "wm_image=@logo.png" \
  -F 'frequency={"mode":"diagonal_tile","spacing_px":280}' \
  -F "opacity=0.3" \
  --output branded.png

# Thai Text Watermark
curl -X POST http://localhost:3000/api/watermark \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "image=@photo.jpg" \
  -F "type=text" \
  -F "text=© ห้ามคัดลอก 2025" \
  -F "font=NotoSansThai" \
  -F 'frequency={"mode":"diagonal_tile","spacing_px":300}' \
  -F "opacity=0.2" \
  -F "font_size=36" \
  -F "color=#000000" \
  --output thai-watermark.png

# Single Position Watermark
curl -X POST http://localhost:3000/api/watermark \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -F "image=@photo.jpg" \
  -F "type=text" \
  -F "text=CONFIDENTIAL" \
  -F "font=Roboto" \
  -F 'frequency={"mode":"single","position":"center"}' \
  -F "opacity=0.4" \
  -F "font_size=64" \
  -F "color=#FF0000" \
  --output confidential.png</code></pre>
            </div>
        </div>

        <!-- Back Button -->
        <div class="text-center mt-12">
            <a href="/index.html" class="inline-block px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full font-semibold text-lg transform hover:scale-105 transition-all">
                ← Back to API Docs
            </a>
        </div>
    </div>

    <script>
        function showTab(tab) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(el => {
                el.classList.remove('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
                el.classList.add('glass');
            });

            // Show selected content
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            const activeTab = document.getElementById(`tab-${tab}`);
            activeTab.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600');
            activeTab.classList.remove('glass');
        }

        function copyCode(elementId, evt) {
            const codeElement = document.getElementById(elementId);
            const code = codeElement.textContent;

            const textToCopy = (elementId === 'ai-prompt' && window.__aiPromptText) ? window.__aiPromptText : code;
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Find the button that was clicked
                const e = evt || window.event; const button = e ? e.target.closest('button') : document.activeElement;
                const originalHTML = button.innerHTML;

                // Show success state
                button.classList.add('copied');
                button.innerHTML = `
                    <span class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Copied!
                    </span>
                `;

                // Reset after 2 seconds
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = originalHTML;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy code');
            });
        }

        // Load AI prompt text from asset and initialize tab
        fetch('/assets/ai_prompt.txt')
          .then(r => r.text())
          .then(t => { window.__aiPromptText = t; /* keep display minimal */ })
          .catch(err => console.error('Failed to load AI prompt:', err));

        showTab('ai');
    </script>
</body>
</html>
